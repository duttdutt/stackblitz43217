# Исполнение

# SSSSSSSSS

## Движок

-   Движок — программное обеспечение, которое исполняет JavaScript.
-   Виды движков:
    -   V8 для Chrome;
    -   Charka для Microsoft;
    -   JavaScriptCore для Safari;
    -   SpiderMonkey для Mozilla.

## Контекст исполнения

-   Окружение, в котором исполняется код.
-   Управляет порядком исполнения кода, привязкой `this`, и создает лексическое окружение.
-   Создается после парсинга, создания синтаксического дерева, JIT-компиляции.
-   Может быть двух типов: глобальным и функциональным.
-   Один глобальный на скрипт.

### Лексическое окружение

-   **Привязки окружения**(Environment Record) собирает все идентификаторы контекста(параметры, переменные, ф-ии).
-   **Ссылка на внешний контекст**(Outer Lexical Environment) ссылается на родительский контекст, откуда получает доступ к лексическому окружению родителя, тем самым получает доступ к переменным/ф-иям родителя.
    -   Если переменная не найдена в текущем окружении, JS ищет ее выше.
    -   Если переменная не найдена в глобальном окружении — `ReferenceError`.

## Переменные

### Идентификатор

-   Используется для создания переменных, функций, классов и т.д.
-   Должен состоять из тестовых символов, цифр, `$`, `_`.
-   Может начинаться с `_`, `$`, но не может начинаться с цифры.
-   Зарезервированные слова не могут быть использованы.
-   Регистро-зависимы: `APPLE !== apple`.

### Создание

1. Объявление: `var x`
    - `const` не может быть объявлен без инициализации.
2. Инициализация: `x = 0`
3. Объявление и инициализация: `var x = 0`

## Область видимости

-   Определяет видимость и доступность переменных.
-   Блочная область видимости: есть у `let` и у `const`, тк она блокируют эти переменные.
-   Функциональная область видимости: есть у `var`, тк она блокирует ее.

## Глобальный объект

-   Объект, который существует в глобальной области видимости.
-   Предоставляет переменные/ф-ии, которые доступны в любом месте:

    ```js
    window.setTimeout(() => {}, 1000);
    setTimeout(() => {}, 1000);

    function foo() {
        return function () {
            return function () {
                return window.setTimeout(() => {}, 1000);
            };
        };
    }
    ```

-   Браузер: `window`, `globalThis`, `global`.
-   Node.js: `global`, `globalThis`.
-   Переменные, объявленные с помощью `var` и объявления ф-ий становятся глобальными в браузере:

    ```ts twoslash
    // @errors: 2322
    const str: string = 1;
    ```

    ```js
    var prop = 100;
    window.prop; // 100

    let prop2 = 20; // [!code warning]
    window.prop2; // undefined [!code warning]

    function a() {
        return 1;
    }
    window.a(); // 1

    var b = function () {
        return 2;
    };
    window.b(); // 2

    let c = function () {}; // [!code warning]
    window.c(); // undefined [!code warning]
    ```

-   Строгий режим не влияет на глобальный объект:
    ```javascript
    "use strict"; // [!code highlight]
    var prop = 100;
    window.prop; // Ok: 100
    ```

## Всплытие

-   Переменные, объявленные с помощью `var` и объявления ф-ий поднимаются вверх текущего контекста.

### `var`

-   Переменные поднимаются, но на этапе создания контекста, им присваивается значение `undefined`.
    ```javascript
    x; // undefined [!code error]
    var x = 5;
    ```

### `let`

### `const`

-   Переменные тоже поднимаются, им тоже присваивается `undefined`, но обращение до объявления запрещено и вызовет `ReferenceError`. Это различие в поведении с `var` называется **Temporal Dead Zone**.
-   **TDZ** начинается от начала контекста до объявления переменной:
    ```javascript
    // [!code error]
    // TDZ [!code error]
    x; // ReferenceError -> still TDZ
    // [!code error]
    // TDZ
    let x = 5; // TDZ is over, x is initialized
    ```

# Функции

-   Мы можем получить доступ к объявлениям ф-ий до объявления:
    ```javascript
    foo(); // "Works"
    function foo() {
        return "Works";
    }
    ```
-   Но мы не можем достучаться до выражений ф-ий и стрелочных ф-ий до объявления, тк поднимается только идентификатор, не значение.
    ```javascript
    console.log(foo); // undefined [!code error]
    var foo = function () {};
    ```

# Замыкание

-   Способность функции сохранять свое лексическое окружение, а значит и ссылку на родительское окружение.
-   Это позволяет ф-ии получить доступ к переменным родителя. При отсутствии соответствующего идентификатора, берет ссылку на родителя у текущей ф-ии и идет вверх, пока не найдет, иначе — `ReferenceError`.
    ```javascript
    let x = 10;
    function outer() {
        return function () {
            return x; // 10
        };
    }
    ```

# Литерал

-   Фиксированное значение, записанное и не хранящееся в переменной(литерал ассоциируется с переменной) или вычисленное. Представляет простейшую форму данных.
-   Иммутабелен — не может меняться.

```javascript
12, 1.2;                           // числовые литералы
"string", `template ${string}`;    // строковые литералы
true, false;                       // булевые литералы
null, undefined;
{}, {x:1, y:3};                    // объектные литералы
[], [foo() {}, class C {}, false]; // литералы массивов
```

-   _Константа_ vs _Литерал_:
    -   _Константа_: переменная с фиксированным значением литерала.
    -   _Литерал_: фиксированное значение, присваиваемое переменной и тд.

## Термины

-   _Операнд_ — то, что применяется к оператору.
    ```javascript
    5 ** 2;
    typeof true;
    ```
-   _Унарный_ — оператор, применяемый в одному операнду.
    ```javascript
    +true;
    -345;
    i++;
    ```
-   _Бинарный_ — оператор, применяемый к двум операндам.
    ```javascript
    5 * 2;
    ```

## Строгий режим

-   **Директива**.
-   Объявляется в начале файла или внутри ф-ии.
-   Используется по дефолту в модулях и классах.
-   Помогает избежать возможных ошибок.

### Изменения

-   _Отключает возможность создания глобальных переменных_.<br/>
    В нестрогом режиме, если переменная объявлена без помощи ключевых слов, то она становиться глобальной. В строгом режиме будет ошибка:
    ```javascript
    // нестрогий режим
    a = 15;
    console.log(a); // 15
    // строгий режим
    a = 15;
    console.log(a); // ReferenceError
    ```
-   _Отключает возможность дублирования параметров ф-ии._<br/>
    В нестрогом режиме возможно объявить ф-ию с двумя одинаковыми идентификаторами. Второй параметр перезапишет первый. Это запрещено в строгом режиме:
    ```javascript
    // нестрогий режим
    function someFunc(a, a) {
        return a;
    }
    console.log(app(1, 2)); // 2
    ```
